#j'ai ajouter/changer les lignes 42,43,84,85,86,90-93,108,109,115,119-125,127,129,139-148
import pygame

pygame.init()

#Dimensions de la fenetre
#acquisition de la resolution de l'ecran
Monitor_info=pygame.display.Info()
Monitor_Width=Monitor_info.current_w   #=valeur de test (temporaire)
Monitor_Height=Monitor_info.current_h  #=valeur de test (temporaire)
Width=Monitor_Width
Height=Monitor_Height
#Variables de gestion du mode plein ecran
Fullscreen_Change=False  #True si bouton Fulscreen appuye Temporaire, doit etre False au debut mais peut varier selon les parametres sauvegardes
Fullscreen=True    #Etat de plein ecran, doit etre True au debut mais peut varier selon les parametres sauvegardes
Resolution_Change=True  #True si resolution changee doit etre True au debut pour tout initialiser mais peut varier selon les parametres sauvegardes

#predefinission des couleurs utiles
White=(255,255,255)
Black=(0,0,0)
Red=(255,0,0)
Green=(0,255,0)
Blue=(0,0,255)
Yellow=(255,255,0)
Orange=(255,165,0)
Gray=(128,128,128)

#Predeffinission de la police et de la couleur des boutons
Menu_font=pygame.font.Font("font.ttf", int(Height*0.05)) ##Definition de la police et de la taille du texte des boutons
button_color=Black
hover_color=Gray
text_color=Orange

#definition des dimensions des boutons
button_width=int(Width*0.25)
button_height=int(Height*0.1)

#Definition des boutons
play_button_rect=pygame.Rect(0,0,button_width,button_height)
settings_button_rect=pygame.Rect(0,0,button_width,button_height)
quit_button_rect=pygame.Rect(0,0,button_width,button_height)
fullscreen_button_rect=pygame.Rect(0, 0, button_width, button_height)
goback_button_rect=pygame.Rect(0, 0, button_width, button_height)

#Creation de la fenetre
screen=pygame.display.set_mode((Width,Height), pygame.FULLSCREEN)   ##Definition de la fenetre avec la resolution
pygame.display.set_caption("Champ de Mars") ##Titre de la fenetre

#Ajout du logo + redissionnement adaptatif a la resolution choisie
logo_import=pygame.image.load("logo_champ_de_mars.png")
logo_import_width=logo_import.get_width()
logo_import_height=logo_import.get_height()
logo=pygame.transform.smoothscale(logo_import,(Width,int(logo_import_height/logo_import_width*Width)))
screen.fill(White)

def Refresh_UI():
    """
    Cette fonction sert a rafraichir l'interface utilisateur en repositionnant les boutons et le logo
    """
    global play_button_rect, settings_button_rect, quit_button_rect, logo, Menu_font
    Monitor_info=pygame.display.Info()
    Monitor_Width=Monitor_info.current_w
    Monitor_Height=Monitor_info.current_h
    Width=Monitor_Width
    Height=Monitor_Height
    if Fullscreen==True:
        screen=pygame.display.set_mode((Width,Height), pygame.FULLSCREEN)
    elif Fullscreen==False:
        screen=pygame.display.set_mode((Width,Height))
    #Repositionnement du logo
    logo=pygame.transform.smoothscale(logo_import,(Width,int(logo_import_height/logo_import_width*Width)))
    #Repositionnement des boutons
    button_width=int(Width*0.25)
    button_height=int(Height*0.1)
    ##Bouton Play
    play_button_rect=pygame.Rect(0,0,button_width,button_height)
    play_button_rect.center=(Width//2, Height//4+100)
    ##Bouton Settings
    settings_button_rect=pygame.Rect(0,0,button_width,button_height)
    settings_button_rect.center=(Width//2, Height//2+100)
    ##Bouton Quit
    quit_button_rect=pygame.Rect(0,0,button_width,button_height)
    quit_button_rect.center=(Width//2, Height*3//4+100)
    ##Bouton Settings-Fullscreen
    fullscreen_button_rect.center = (Width // 2, Height // 2+100)
    ##Bouton Settings-Go Back
    goback_button_rect.center = (Width//2, Height*3//4+100)
    ##Taille de la police
    Menu_font=pygame.font.Font("font.ttf", int(Height*0.05))

#on définit les variables pour les changement de scène du menu
menu_main="main"
menu_settings="settings"
current_menu=menu_main

while True:
    #Recuperation de la position de la souris
    mouse_pos=pygame.mouse.get_pos()
    #Raffraichissement du logo sur l'ecran
    screen.fill(White)  ##Fond blanc
    screen.blit(logo,(0,0))     ##Affichage du logo en haut de l'ecran

    #Quitter le jeu
    for event in pygame.event.get():    ##Recuperation des evenements
        if event.type == pygame.QUIT:   ##Si on clique sur la croix
            pygame.quit()       ##Quitte pygame
            exit()      ##Quitte le programme
        if event.type == pygame.MOUSEBUTTONDOWN:   ##Si un bouton de la souris est appuye 
            #   Main Menu   #
            if current_menu==menu_main: ##Si on est dans le menu principal
                if play_button_rect.collidepoint(mouse_pos):   ##Si le bouton Play est appuye
                    print("Play button clicked")   ##Action du bouton Play (a definir)

                if settings_button_rect.collidepoint(mouse_pos):   ##Si le bouton Settings est appuye
                    print("Settings button clicked")   ##Action du bouton Settings (a definir)
                    current_menu=menu_settings
                if quit_button_rect.collidepoint(mouse_pos):   ##Si le bouton Quit est appuye
                    pygame.quit()       ##Quitte pygame
                    exit()      ##Quitte le programme
            #   Settings Menu   #
            elif current_menu==menu_settings: ##Si on est dans le menu des parametres
                if fullscreen_button_rect.collidepoint(mouse_pos):   ##Si le bouton Fullscreen est appuye
                    print("Fullscreen button clicked")
                    Fullscreen_Change=True
                    Fullscreen=not Fullscreen
                if goback_button_rect.collidepoint(mouse_pos):   ##Si le bouton Go Back est appuye
                    print("Go Back button clicked")
                    current_menu=menu_main ##on retourne au menu principal
    #dessine les boutons et le texte
    if current_menu==menu_main: #les boutons dans le menu principal
        for rect,texte in [(play_button_rect,"Play"),(settings_button_rect,"Settings"),(quit_button_rect,"Quit")]:
            if rect.collidepoint(mouse_pos):    ##Si la souris est au dessus du bouton
                button_color=hover_color    ##Change la couleur du bouton
            else:
                button_color=Black
            pygame.draw.rect(screen,button_color, rect)   ##Dessin du bouton
            texte_surface=Menu_font.render(texte,True,Orange)    ##Creation du texte
            texte_rect=texte_surface.get_rect(center=rect.center)   ##Centrage du texte
            screen.blit(texte_surface, texte_rect)  ##Affichage du texte
    elif current_menu==menu_settings: #les boutons dans le menu des parametres
        for rect,texte in [(fullscreen_button_rect,"Toggle Fullscreen"),(goback_button_rect,"Go Back")]:
            if rect.collidepoint(mouse_pos):    ##Si la souris est au dessus du bouton
                button_color=hover_color    ##Change la couleur du bouton
            else:
                button_color=Black
            pygame.draw.rect(screen,button_color, rect)   ##Dessin du bouton
            texte_surface=Menu_font.render(texte,True,Orange)    ##Creation du texte
            texte_rect=texte_surface.get_rect(center=rect.center)   ##Centrage du texte
            screen.blit(texte_surface, texte_rect)  ##Affichage du texte

    #Toggle du fullscreen
    if Fullscreen_Change==True or Resolution_Change==True:
        Fullscreen_Change=False
        Resolution_Change=False
        Refresh_UI()
    pygame.display.flip()
